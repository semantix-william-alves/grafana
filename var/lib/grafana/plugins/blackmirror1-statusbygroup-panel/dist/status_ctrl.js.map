{"version":3,"sources":["../src/status_ctrl.js"],"names":["MetricsPanelCtrl","_","TimeSeries","coreModule","kbn","moment","panelDefaults","flipCard","flipTime","colorMode","colors","crit","warn","ok","disable","isGrayOnNoData","isIgnoreOKColors","isHideAlertsOnDisable","cornerRadius","isAutoScrollOnOverflow","StatusPluginCtrl","$scope","$injector","$log","$filter","annotationsSrv","uiSegmentSrv","defaultsDeep","panel","filter","valueHandlers","aggregations","displayTypes","displayAliasTypes","displayValueTypes","colorModes","fontFormats","statusMetrics","statusGroups","unshift","name","alias","url","each","targets","t","valueHandler","Date","events","on","onRender","bind","postRefresh","onDataError","onDataReceived","onInitEditMode","onColorChange","statusCrit","statusWarn","statusMetric","addFilters","numberOrTextFilter","input","angular","isNumber","$stateful","textRegex","length","regex","RegExp","e","matchResults","match","fixedSpan","span","measurements","duplicates","measurement","hide","m","res","target","addEditorTab","unitFormats","getUnitFormats","subItem","units","value","render","panelHeaderHeight","title","$panelContainer","find","css","$panelContoller","height","minHeight","tail","panelWidth","innerWidth","isNaN","parseInt","slice","maxWidth","element","overflowY","offsetHeight","scrollHeight","Number","undefined","String","c","w","getTime","item","color","fixPanelHeader","setElementHeight","setTextMaxWidth","upgradeOldVersion","clusterName","displayName","replace","namePrefix","addClass","removeClass","disabled","display","annotation","extraMoreAlerts","groupCrit","groupWarn","statusGroupExists","forEach","series","s","isDisplayValue","displayType","valueDisplayRegex","hasOwnProperty","group","validateRegex","aggregation","max","datapoints","point","stats","min","diff","total","avg","display_value","handleThresholdStatus","handleDisabledStatus","handleTextOnly","autoFlip","updatePanelState","handleCssDisplay","parseUri","handleMaxAlertsToShow","displayAliasType","displayValueWithAlias","isFloat","thresholds","parseThresholds","inverted","isCritical","isWarning","isStatus","isCheckRanges","warnIsNumber","critIsNumber","formatDisplayValue","displayValueWhenAliasDisplayed","displayValueFromWarning","displayValueFromCritical","push","isFinite","decimals","decimalPlaces","Math","valueFormats","date","dashboard","isTimezoneUtc","utc","format","dateFormat","num","disabledValue","panelState","radius","okColor","maxAlertNumber","currentMaxAllowedAlerts","filteredOutAlerts","arrayNamesToSlice","originAlertCount","arrayName","links","link","type","uri","dashUri","params","targetBlank","dataList","map","seriesHandler","timeoutId","clearInterval","setInterval","toggleClass","scope","elem","attrs","ctrl","groupname","duplicate","without","text","count","status","metricOptions","parseFloat","valueOf","val","toString","toLowerCase","indexOf","seriesData","flotpairs","getFlotPairs","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,mB,kBAAAA,gB;;AACDC,I;;AACAC,a;;AACAC,a;;AACAC,M;;AACAC,S;;;;;;;;;;;;;;;;;;;;;AAKDC,gB,GAAgB;AACrBC,cAAU,KADW;AAErBC,cAAU,CAFW;AAGrBC,eAAW,OAHU;AAIrB;AACAC,YAAQ;AACPC,WAAM,wBADC;AAEPC,WAAM,yBAFC;AAGPC,SAAI,wBAHG;AAIPC,cAAS;AAJF,KALa;AAWrBC,oBAAgB,KAXK;AAYrBC,sBAAkB,KAZG;AAarBC,2BAAuB,KAbF;AAcrBC,kBAAc,CAdO;AAerBC,4BAAwB;AAfH,I;;+BAkBTC,gB;;;AACZ;AACA,8BAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,IAA/B,EAAqCC,OAArC,EAA8CC,cAA9C,EAA8DC,YAA9D,EAA4E;AAAA;;AAAA,qIACrEL,MADqE,EAC7DC,SAD6D;;AAE3ErB,OAAE0B,YAAF,CAAe,MAAKC,KAApB,EAA2BtB,aAA3B;;AAEA;AACA,WAAKuB,MAAL,GAAcL,OAAd;;AAEA,WAAKM,aAAL,GAAqB,CAAC,kBAAD,EAAqB,kBAArB,EAAyC,gBAAzC,EAA2D,kBAA3D,EAA+E,WAA/E,CAArB;AACA,WAAKC,YAAL,GAAoB,CAAC,MAAD,EAAS,OAAT,EAAkB,KAAlB,EAAyB,KAAzB,EAAgC,KAAhC,EAAuC,KAAvC,EAA8C,OAA9C,CAApB;AACA,WAAKC,YAAL,GAAoB,CAAC,SAAD,EAAY,YAAZ,CAApB;AACA,WAAKC,iBAAL,GAAyB,CAAC,oBAAD,EAAuB,QAAvB,CAAzB;AACA,WAAKC,iBAAL,GAAyB,CAAC,OAAD,EAAU,sBAAV,EAAkC,oBAAlC,EAAwD,eAAxD,CAAzB;AACA,WAAKC,UAAL,GAAkB,CAAC,OAAD,EAAU,QAAV,EAAoB,UAApB,CAAlB;AACA,WAAKC,WAAL,GAAmB,CAAC,SAAD,EAAY,MAAZ,EAAoB,QAApB,CAAnB;AACA,WAAKC,aAAL,GAAqB,EAArB;;AAEA;AACA,SAAG,CAAC,MAAKT,KAAL,CAAWU,YAAf,EAA6B;AAC5B,YAAKV,KAAL,CAAWU,YAAX,GAA0B,EAA1B;AACA,YAAKV,KAAL,CAAWU,YAAX,CAAwBC,OAAxB,CAAgC,EAACC,MAAM,eAAP,EAAwBC,OAAO,EAA/B,EAAmCC,KAAK,EAAxC,EAAhC;AACA;;AAED;AACAzC,OAAE0C,IAAF,CAAO,MAAKf,KAAL,CAAWgB,OAAlB,EAA2B,UAACC,CAAD,EAAO;AACjC,UAAIA,EAAEC,YAAF,KAAmB,gBAAvB,EAAyC;AACxC,WAAI,OAAOD,EAAElC,IAAT,IAAiB,WAArB,EAAkCkC,EAAElC,IAAF,GAAS,IAAIoC,IAAJ,CAASF,EAAElC,IAAX,CAAT;AAClC,WAAI,OAAOkC,EAAEjC,IAAT,IAAiB,WAArB,EAAkCiC,EAAEjC,IAAF,GAAS,IAAImC,IAAJ,CAASF,EAAEjC,IAAX,CAAT;AAClC;AACD,MALD;;AAOA,WAAKgB,KAAL,CAAWpB,QAAX,GAAsB,MAAKoB,KAAL,CAAWpB,QAAX,IAAuB,CAA7C;;AAEA;AACA,WAAKwC,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKC,QAAL,CAAcC,IAAd,OAAzB;AACA,WAAKH,MAAL,CAAYC,EAAZ,CAAe,SAAf,EAA0B,MAAKG,WAAL,CAAiBD,IAAjB,OAA1B;AACA,WAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKI,WAAL,CAAiBF,IAAjB,OAA7B;AACA,WAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKK,cAAL,CAAoBH,IAApB,OAAhC;AACA,WAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKK,cAAL,CAAoBH,IAApB,OAArC;AACA,WAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKM,cAAL,CAAoBJ,IAApB,OAAjC;;AAEA,WAAKK,aAAL,GAAqB,MAAKA,aAAL,CAAmBL,IAAnB,OAArB;;AAEA,WAAKM,UAAL,GAAkB,EAAlB;AACA,WAAKC,UAAL,GAAkB,EAAlB;AACA,WAAKC,YAAL,GAAoB,IAApB;;AAEA,WAAKC,UAAL;AA9C2E;AA+C3E;;;;kCAEY;AAAA;;AACZzD,iBAAW0B,MAAX,CAAkB,cAAlB,EAAkC,YAAM;AACvC,WAAIgC,qBAAqB,SAArBA,kBAAqB,CAACC,KAAD,EAAW;AACnC,YAAGC,QAAQC,QAAR,CAAiBF,KAAjB,CAAH,EAA4B;AAC3B,gBAAO,OAAKjC,MAAL,CAAY,QAAZ,EAAsBiC,KAAtB,CAAP;AACA,SAFD,MAEO;AACN,gBAAOA,KAAP;AACA;AACD,QAND;;AAQAD,0BAAmBI,SAAnB,GAA+B,IAA/B;AACA,cAAOJ,kBAAP;AACA,OAXD;;AAaA1D,iBAAW0B,MAAX,CAAkB,uBAAlB,EAA2C,YAAM;AAChD,WAAIgC,qBAAqB,SAArBA,kBAAqB,CAACC,KAAD,EAAQI,SAAR,EAAsB;AAC9C,YAAGH,QAAQC,QAAR,CAAiBF,KAAjB,CAAH,EAA4B;AAC3B,gBAAO,OAAKjC,MAAL,CAAY,QAAZ,EAAsBiC,KAAtB,CAAP;AACA,SAFD,MAEO;AACN,aAAGI,aAAa,IAAb,IAAqBA,UAAUC,MAAV,IAAoB,CAA5C,EAA+C;AAC9C,iBAAOL,KAAP;AACA,UAFD,MAEO;AACN,cAAIM,cAAJ;;AAEA,cAAI;AACHA,mBAAQ,IAAIC,MAAJ,CAAWH,SAAX,CAAR;AACA,WAFD,CAEE,OAAOI,CAAP,EAAU;AACX,kBAAOR,KAAP;AACA;;AAED,cAAI,CAACA,KAAL,EAAY;AACX,kBAAOA,KAAP;AACA;;AAED,cAAIS,eAAeT,MAAMU,KAAN,CAAYJ,KAAZ,CAAnB;AACA,cAAIG,gBAAgB,IAApB,EAA0B;AACzB,kBAAOT,KAAP;AACA,WAFD,MAEO;AACN,kBAAOS,aAAa,CAAb,CAAP;AACA;AACD;AACD;AACD,QA3BD;;AA6BAV,0BAAmBI,SAAnB,GAA+B,IAA/B;AACA,cAAOJ,kBAAP;AACA,OAhCD;AAiCA;;;mCAEa;AAAA;;AACb,UAAI,KAAKjC,KAAL,CAAW6C,SAAf,EAA0B;AACzB,YAAK7C,KAAL,CAAW8C,IAAX,GAAkB,KAAK9C,KAAL,CAAW6C,SAA7B;AACA;;AAED,WAAKE,YAAL,GAAoB,KAAK/C,KAAL,CAAWgB,OAA/B;;AAEA;AACA,WAAKgC,UAAL,GAAkB,KAAlB;;AAEA,WAAKD,YAAL,GAAoB1E,EAAE4B,MAAF,CAAS,KAAK8C,YAAd,EAA4B,UAACE,WAAD,EAAiB;AAChE,cAAO,CAACA,YAAYC,IAApB;AACA,OAFmB,CAApB;;AAIA7E,QAAE0C,IAAF,CAAO,KAAKgC,YAAZ,EAA0B,UAACI,CAAD,EAAO;AAChC,WAAIC,MAAM/E,EAAE4B,MAAF,CAAS,OAAK8C,YAAd,EAA4B,UAACE,WAAD,EAAiB;AACtD,eAAO,CAACE,EAAEtC,KAAF,IAAWoC,YAAYpC,KAAvB,IAAiCsC,EAAEE,MAAF,IAAYJ,YAAYI,MAAxB,IAAkCF,EAAEE,MAAtE,KAAkF,CAACF,EAAED,IAA5F;AACA,QAFS,CAAV;;AAIA,WAAIE,IAAIb,MAAJ,GAAa,CAAjB,EAAoB;AACnB,eAAKS,UAAL,GAAkB,IAAlB;AACA;AACD,OARD;AASA;;;sCAEgB;AAChB,WAAKM,YAAL,CAAkB,SAAlB,EAA6B,6DAA7B,EAA4F,CAA5F;AACA;AACA,WAAKC,WAAL,GAAmB/E,IAAIgF,cAAJ,EAAnB;AACA;;;mCAEaP,W,EAAaQ,O,EAAS;AACnCR,kBAAYS,KAAZ,GAAoBD,QAAQE,KAA5B;AACA,WAAKC,MAAL;AACA;;;sCAEgB;AAChB;AACA,UAAIC,oBAAoB,EAAxB;AACA,UAAG,KAAK7D,KAAL,CAAW8D,KAAX,CAAiBvB,MAAjB,KAA4B,CAA/B,EAAkC;AACjCsB,2BAAoB,MAApB;AACA;AACD,WAAKE,eAAL,CAAqBC,IAArB,CAA0B,eAA1B,EAA2CC,GAA3C,CAA+C,QAA/C,EAAyDJ,iBAAzD;AACA,WAAKE,eAAL,CAAqBC,IAArB,CAA0B,uBAA1B,EAAmDC,GAAnD,CAAuD,QAAvD,EAAiEJ,iBAAjE;AACA,WAAKE,eAAL,CAAqBC,IAArB,CAA0B,gBAA1B,EAA4CC,GAA5C,CAAgD,SAAhD,EAA2D,MAA3D;AACA;;;wCAEkB;AAClB;AACA,WAAKF,eAAL,CAAqBC,IAArB,CAA0B,eAA1B,EAA2CC,GAA3C,CAA+C,YAA/C,EAA6D,KAAKC,eAAL,CAAqBC,MAArB,GAA8B,IAA3F;AACA,WAAKC,SAAL,GAAiB,KAAKF,eAAL,CAAqBC,MAArB,GAA4B,EAA7C;AACA;;;uCAEiB;AACjB,UAAIE,OAAO,IAAX;AACA,UAAIC,aAAa,KAAKP,eAAL,CAAqBQ,UAArB,EAAjB;AACA,UAAIC,MAAMF,UAAN,CAAJ,EACCA,aAAaG,SAASH,WAAWI,KAAX,CAAiB,CAAjB,EAAoB,CAAC,CAArB,CAAT,EAAkC,EAAlC,IAAwC,EAArD;AACDJ,mBAAaA,aAAa,EAA1B;AACA,WAAKK,QAAL,GAAgBL,UAAhB;AACA;;;0CAEoB;AACpB,UAAG,CAAC,KAAKtE,KAAL,CAAWT,sBAAf,EAAuC;AACtC,cAAO,KAAP;AACA;;AAED,UAAIqF,UAAU,KAAKb,eAAL,CAAqBC,IAArB,CAA0B,eAA1B,EAA2C,CAA3C,CAAd;AACA,UAAIa,YAAYD,QAAQE,YAAR,GAAuBF,QAAQG,YAA/C;AACA,aAAOF,SAAP;AACA;;;qCAEe5B,W,EAAa;AAC5B;AACA,UAAIA,YAAY/B,YAAZ,KAA6B,kBAAjC,EAAqD;AACpD+B,mBAAYlE,IAAZ,GAAoByF,MAAMQ,OAAO/B,YAAYlE,IAAnB,CAAN,CAAD,GAAoCkG,SAApC,GAAgDD,OAAO/B,YAAYlE,IAAnB,CAAnE;AACAkE,mBAAYjE,IAAZ,GAAoBwF,MAAMQ,OAAO/B,YAAYjE,IAAnB,CAAN,CAAD,GAAoCiG,SAApC,GAAgDD,OAAO/B,YAAYjE,IAAnB,CAAnE;AACA,OAHD,MAGO,IAAIiE,YAAY/B,YAAZ,KAA6B,kBAAjC,EAAqD;AAC3D,WAAI,OAAO+B,YAAYlE,IAAnB,IAA2B,WAA/B,EAA4CkE,YAAYlE,IAAZ,GAAmBmG,OAAOjC,YAAYlE,IAAnB,CAAnB;AAC5C,WAAI,OAAOkE,YAAYjE,IAAnB,IAA2B,WAA/B,EAA4CiE,YAAYjE,IAAZ,GAAmBkG,OAAOjC,YAAYjE,IAAnB,CAAnB;AAC5C,OAHM,MAGA,IAAIiE,YAAY/B,YAAZ,KAA6B,gBAAjC,EAAmD;AACzD,WAAIiE,IAAI,IAAIhE,IAAJ,CAAS8B,YAAYlE,IAArB,CAAR;AAAA,WAAoCqG,IAAI,IAAIjE,IAAJ,CAAS8B,YAAYjE,IAArB,CAAxC;AACAiE,mBAAYlE,IAAZ,GAAoByF,MAAMW,EAAEE,OAAF,EAAN,CAAD,GAAuBJ,SAAvB,GAAmCE,CAAtD;AACAlC,mBAAYjE,IAAZ,GAAoBwF,MAAMY,EAAEC,OAAF,EAAN,CAAD,GAAuBJ,SAAvB,GAAmCG,CAAtD;AACA;AACD,WAAK9D,QAAL;AACA;;;mCAEagE,I,EAAM;AAAA;;AACnB,aAAO,UAACC,KAAD,EAAW;AACjB,cAAKvF,KAAL,CAAWlB,MAAX,CAAkBwG,IAAlB,IAA0BC,KAA1B;AACA,cAAK3B,MAAL;AACA,OAHD;AAIA;;;gCAEU;AAAA;;AACV,WAAK4B,cAAL;AACA,WAAKC,gBAAL;AACA,WAAKC,eAAL;AACA,WAAKC,iBAAL;;AAEA,UAAI,KAAK3F,KAAL,CAAW4F,WAAf,EAA4B;AAC3B,YAAK5F,KAAL,CAAW6F,WAAX,GACC,KAAK5F,MAAL,CAAY,yBAAZ,EAAuC,KAAKD,KAAL,CAAW4F,WAAlD,EAA+D,KAAKnG,MAApE,EACEqG,OADF,CACU,IAAIrD,MAAJ,CAAW,KAAKzC,KAAL,CAAW+F,UAAtB,EAAkC,GAAlC,CADV,EACkD,EADlD,CADD;AAGA,OAJD,MAIO;AACN,YAAK/F,KAAL,CAAW6F,WAAX,GAAyB,EAAzB;AACA;;AAED,UAAG,KAAK7F,KAAL,CAAWrB,QAAd,EAAuB;AACtB,YAAKoF,eAAL,CAAqBiC,QAArB,CAA8B,cAA9B;AACA,OAFD,MAEO;AACN,YAAKjC,eAAL,CAAqBkC,WAArB,CAAiC,cAAjC;AACA;;AAED,UAAIjF,UAAU,KAAKhB,KAAL,CAAWgB,OAAzB;;AAEA,WAAKjC,IAAL,GAAY,EAAZ;AACA,WAAKC,IAAL,GAAY,EAAZ;AACA,WAAK6C,UAAL,GAAkB,EAAlB;AACA,WAAKC,UAAL,GAAkB,EAAlB;AACA,WAAKoE,QAAL,GAAgB,EAAhB;AACA,WAAKC,OAAL,GAAe,EAAf;AACA,WAAKC,UAAL,GAAkB,EAAlB;AACA,WAAKC,eAAL,GAAuB,IAAvB;;AAEA,WAAK5F,aAAL,GAAqB,EAArB;AACA,WAAK6F,SAAL,GAAiB,EAAjB;AACA,WAAKC,SAAL,GAAiB,EAAjB;;AAEA,UAAG,KAAKvG,KAAL,CAAWU,YAAd,EAA2B;AAC1B,WAAI8F,oBAAoB,KAAxB;AACA,YAAKxG,KAAL,CAAWU,YAAX,CAAwB+F,OAAxB,CAAgC,mBAAW;AAC1C,eAAKH,SAAL,CAAe1B,QAAQhE,IAAvB,IAA+B,EAA/B;AACA,eAAK2F,SAAL,CAAe3B,QAAQhE,IAAvB,IAA+B,EAA/B;AACA,YAAGgE,QAAQhE,IAAR,KAAiB,eAApB,EAAoC;AACnC4F,6BAAoB,IAApB;AACA;AACD,QAND;AAOA,WAAG,CAACA,iBAAJ,EAAsB;AACrB,aAAKxG,KAAL,CAAWU,YAAX,CAAwBC,OAAxB,CAAgC,EAACC,MAAM,eAAP,EAAwBC,OAAO,EAA/B,EAAmCC,KAAK,EAAxC,EAAhC;AACA;AACD;;AAEDzC,QAAE0C,IAAF,CAAO,KAAK2F,MAAZ,EAAoB,UAACC,CAAD,EAAO;AAC1B,WAAItD,SAAShF,EAAE2F,IAAF,CAAOhD,OAAP,EAAgB,UAACqC,MAAD,EAAY;AACxC,eAAOA,OAAOxC,KAAP,IAAgB8F,EAAE9F,KAAlB,IAA2BwC,OAAOA,MAAP,IAAiBsD,EAAE9F,KAArD;AACA,QAFY,CAAb;;AAIA,WAAI,CAACwC,MAAL,EAAa;AACZ;AACA;;AAEDsD,SAAE9F,KAAF,GAAUwC,OAAOxC,KAAjB;AACA8F,SAAE7F,GAAF,GAAQuC,OAAOvC,GAAf;AACA6F,SAAEC,cAAF,GAAmB,IAAnB;AACAD,SAAEE,WAAF,GAAgBxD,OAAOwD,WAAvB;AACAF,SAAEG,iBAAF,GAAsB,EAAtB;AACA,WAAG,OAAK9G,KAAL,CAAWU,YAAd,EAA2B;AAC1B,eAAKV,KAAL,CAAWU,YAAX,CAAwB+F,OAAxB,CAAgC,mBAAW;AAC1C,aAAGpD,OAAO0D,cAAP,CAAsB,OAAtB,KAAkCnC,QAAQhE,IAAR,KAAiByC,OAAO2D,KAAP,CAAapG,IAAnE,EAAwE;AACvE+F,YAAEK,KAAF,GAAUpC,OAAV;AACA;AACD,SAJD;AAKA;AACD;;AAEA,WAAG,OAAKqC,aAAL,CAAmB5D,OAAOyD,iBAA1B,CAAH,EAAiD;AAChDH,UAAEG,iBAAF,GAAsBzD,OAAOyD,iBAA7B;AACA;;AAED,WAAInD,cAAJ;AACA,eAAQN,OAAO6D,WAAf;AACC,aAAK,KAAL;AACCvD,iBAAQtF,EAAE8I,GAAF,CAAMR,EAAES,UAAR,EAAoB,UAACC,KAAD,EAAW;AAAE,iBAAOA,MAAM,CAAN,CAAP;AAAkB,UAAnD,EAAqD,CAArD,CAAR;AACA1D,iBAAQgD,EAAEW,KAAF,CAAQH,GAAhB;AACA;AACD,aAAK,KAAL;AACCxD,iBAAQtF,EAAEkJ,GAAF,CAAMZ,EAAES,UAAR,EAAoB,UAACC,KAAD,EAAW;AAAE,iBAAOA,MAAM,CAAN,CAAP;AAAkB,UAAnD,EAAqD,CAArD,CAAR;AACA1D,iBAAQgD,EAAEW,KAAF,CAAQC,GAAhB;AACA;AACD,aAAK,OAAL;AACC5D,iBAAQgD,EAAES,UAAF,CAAaT,EAAES,UAAF,CAAa7E,MAAb,GAAsB,CAAnC,EAAsC,CAAtC,IAA2CoE,EAAES,UAAF,CAAa,CAAb,EAAgB,CAAhB,CAAnD;AACAzD,iBAAQgD,EAAEW,KAAF,CAAQE,IAAhB;AACA;AACD,aAAK,KAAL;AACC7D,iBAAQ,CAAR;AACAtF,WAAE0C,IAAF,CAAO4F,EAAES,UAAT,EAAqB,UAACC,KAAD,EAAW;AAAE1D,mBAAS0D,MAAM,CAAN,CAAT;AAAmB,UAArD;AACA1D,iBAAQgD,EAAEW,KAAF,CAAQG,KAAhB;AACA;AACD,aAAK,KAAL;AACC9D,iBAAQgD,EAAEW,KAAF,CAAQI,GAAhB;AACA;AACD,aAAK,OAAL;AACC/D,iBAAQgD,EAAES,UAAF,CAAa,CAAb,EAAgB,CAAhB,CAAR;AACA;AACD;AACCzD,iBAAQgD,EAAES,UAAF,CAAaT,EAAES,UAAF,CAAa7E,MAAb,GAAsB,CAAnC,EAAsC,CAAtC,CAAR;AAzBF;;AA4BAoE,SAAEgB,aAAF,GAAkBhE,KAAlB;;AAEA,WAAIN,OAAOnC,YAAP,IAAuB,kBAAvB,IACHmC,OAAOnC,YAAP,IAAuB,kBADpB,IAEHmC,OAAOnC,YAAP,IAAuB,gBAFxB,EAE0C;AACzC,eAAK0G,qBAAL,CAA2BjB,CAA3B,EAA8BtD,MAA9B;AACA,QAJD,MAKK,IAAIA,OAAOnC,YAAP,IAAuB,kBAA3B,EAA+C;AACnD,eAAK2G,oBAAL,CAA0BlB,CAA1B,EAA4BtD,MAA5B;AACA,QAFI,MAGA,IAAIA,OAAOnC,YAAP,IAAuB,WAA3B,EAAwC;AAC5C,eAAK4G,cAAL,CAAoBnB,CAApB,EAAuBtD,MAAvB;AACA;;AAED;AACA,OAvED;;AAyEA,UAAG,KAAKrD,KAAL,CAAWX,qBAAX,IAAoC,KAAK6G,QAAL,CAAc3D,MAAd,GAAuB,CAA9D,EAAiE;AAChE,YAAKxD,IAAL,GAAY,EAAZ;AACA,YAAKC,IAAL,GAAY,EAAZ;AACA,YAAKsH,SAAL,GAAiB,EAAjB;AACA,YAAKC,SAAL,GAAiB,EAAjB;AACA,YAAKJ,OAAL,GAAe,EAAf;AACA;;AAED,WAAK4B,QAAL;AACA,WAAKC,gBAAL;AACA,WAAKC,gBAAL;AACA,WAAKC,QAAL;;AAEA;AACA,WAAKC,qBAAL;AACA;;;yCAEmB;AAAA;;AACnB,UAAInH,UAAU,KAAKhB,KAAL,CAAWgB,OAAzB;;AAEA;AACA3C,QAAE0C,IAAF,CAAOC,OAAP,EAAgB,UAACqC,MAAD,EAAY;AAC3B,WAAGA,OAAOnC,YAAP,IAAuB,IAA1B,EAAgC;AAC/B,YAAGmC,OAAOwD,WAAP,IAAsB,IAAzB,EAA+B;AAC9BxD,gBAAOnC,YAAP,GAAsBmC,OAAOwD,WAA7B;AACA,aAAIxD,OAAOnC,YAAP,IAAuB,YAA3B,EAAyC;AACxCmC,iBAAOnC,YAAP,GAAsB,WAAtB;AACA;AACD,SALD,MAKO;AACNmC,gBAAOnC,YAAP,GAAsB,OAAKhB,aAAL,CAAmB,CAAnB,CAAtB;AACA;AACDmD,eAAOwD,WAAP,GAAqB,OAAKzG,YAAL,CAAkB,CAAlB,CAArB;AACA;;AAED,WAAGiD,OAAO8C,OAAP,IAAkB,IAArB,EAA0B;AACzB9C,eAAO+E,gBAAP,GAA0B/E,OAAO8C,OAAP,GAAiB,QAAjB,GAA4B,OAAK9F,iBAAL,CAAuB,CAAvB,CAAtD;AACAgD,eAAOgF,qBAAP,GAA+BhF,OAAO8C,OAAP,GAAiB,sBAAjB,GAA0C,OAAK7F,iBAAL,CAAuB,CAAvB,CAAzE;AACA,eAAO+C,OAAO8C,OAAd;AAEA;AACD,OAnBD;;AAqBA;AACA9H,QAAE0C,IAAF,CAAOC,OAAP,EAAgB,UAACqC,MAAD,EAAY;AAC3B,WAAIA,OAAOnC,YAAP,KAAwB,WAA5B,EAAyC;AACxC;AACA;AACA,YAAI1B,iBAAiB8I,OAAjB,CAAyBjF,OAAOtE,IAAhC,KAAyCS,iBAAiB8I,OAAjB,CAAyBjF,OAAOrE,IAAhC,CAA7C,EAAoF;AACnFqE,gBAAOnC,YAAP,GAAsB,kBAAtB;AACAmC,gBAAOtE,IAAP,GAAciG,OAAO3B,OAAOtE,IAAd,CAAd;AACAsE,gBAAOrE,IAAP,GAAcgG,OAAO3B,OAAOrE,IAAd,CAAd;AACA,SAJD,MAIO;AACNqE,gBAAOnC,YAAP,GAAsB,kBAAtB;AACA,aAAI,OAAOmC,OAAOtE,IAAd,IAAsB,WAA1B,EAAuCsE,OAAOtE,IAAP,GAAcmG,OAAO7B,OAAOtE,IAAd,CAAd;AACvC,aAAI,OAAOsE,OAAOrE,IAAd,IAAsB,WAA1B,EAAuCqE,OAAOrE,IAAP,GAAckG,OAAO7B,OAAOrE,IAAd,CAAd;AACvC;AACD;AACD,OAdD;AAeA;;;2CAEqB0H,M,EAAQrD,M,EAAQ;AACrCqD,aAAO6B,UAAP,GAAoB/I,iBAAiBgJ,eAAjB,CAAiCnF,MAAjC,CAApB;AACAqD,aAAO+B,QAAP,GAAkB/B,OAAO6B,UAAP,CAAkBxJ,IAAlB,GAAyB2H,OAAO6B,UAAP,CAAkBvJ,IAA7D;;AAEA,UAAI0J,aAAa,KAAjB;AACA,UAAIC,YAAY,KAAhB;AACA,UAAIC,WAAW,KAAf;AACA,UAAIC,gBAAgBnC,OAAO6B,UAAP,CAAkBO,YAAlB,IAAkCpC,OAAO6B,UAAP,CAAkBQ,YAAxE;;AAEA;;AAEA,UAAIrC,OAAOK,cAAP,CAAsB,OAAtB,KAAkCL,OAAOM,KAAP,KAAiB,KAAKhH,KAAL,CAAWU,YAAX,CAAwB,CAAxB,CAAvD,EAAkF;AACjFkI,kBAAW,IAAX;AACA;AACA;;AAED,UAAIC,aAAJ,EAAmB;AAClB,WAAI,CAACnC,OAAO+B,QAAZ,EAAsB;AACrB,YAAI/B,OAAOiB,aAAP,IAAwBjB,OAAO6B,UAAP,CAAkBxJ,IAA9C,EAAoD;AACnD2J,sBAAa,IAAb;AACA,SAFD,MAEO,IAAIhC,OAAOiB,aAAP,IAAwBjB,OAAO6B,UAAP,CAAkBvJ,IAA9C,EAAoD;AAC1D2J,qBAAY,IAAZ;AACA;AACD,QAND,MAMO;AACN,YAAIjC,OAAOiB,aAAP,IAAwBjB,OAAO6B,UAAP,CAAkBxJ,IAA1C,IAAkD2H,OAAO7F,KAA7D,EAAoE;AACnE6H,sBAAa,IAAb;AACA,SAFD,MAEO,IAAIhC,OAAOiB,aAAP,IAAwBjB,OAAO6B,UAAP,CAAkBvJ,IAA9C,EAAoD;AAC1D2J,qBAAY,IAAZ;AACA;AACD;AACD,OAdD,MAcO;AACN,WAAIjC,OAAOiB,aAAP,IAAwBjB,OAAO6B,UAAP,CAAkBxJ,IAA1C,IAAkD2H,OAAO7F,KAA7D,EAAoE;AACnE6H,qBAAa,IAAb;AACA,QAFD,MAEO,IAAIhC,OAAOiB,aAAP,IAAwBjB,OAAO6B,UAAP,CAAkBvJ,IAA9C,EAAoD;AAC1D2J,oBAAY,IAAZ;AACA;AACD;;AAED;AACAjC,aAAOiB,aAAP,GAAuB,KAAKqB,kBAAL,CAAwBtC,OAAOiB,aAA/B,EAA8CtE,MAA9C,CAAvB;;AAEA,UAAI4F,iCAAiC,2BAA2B5F,OAAOgF,qBAAvE;AACA,UAAIa,0BAA0B,yBAAyB7F,OAAOgF,qBAA9D;AACA,UAAIc,2BAA2B,oBAAoB9F,OAAOgF,qBAA1D;;AAEA,UAAGK,UAAH,EAAe;AACd;AACAhC,cAAOG,WAAP,GAAqB,KAAKzG,YAAL,CAAkB,CAAlB,CAArB;AACAsG,cAAOE,cAAP,GAAwBqC,kCAAkCC,uBAAlC,IAA6DC,wBAArF;AACA,WAAGP,QAAH,EAAa;AACZ,aAAK/G,UAAL,CAAgBuH,IAAhB,CAAqB1C,MAArB;AACA,QAFD,MAGK;AACJ,aAAK3H,IAAL,CAAUqK,IAAV,CAAe1C,MAAf;AACA,YAAGA,OAAOK,cAAP,CAAsB,OAAtB,CAAH,EAAmC;AAClC,cAAKT,SAAL,CAAeI,OAAOM,KAAP,CAAapG,IAA5B,EAAkCwI,IAAlC,CAAuC1C,MAAvC;AACA;AACD;AACD,OAbD,MAaO,IAAGiC,SAAH,EAAc;AACpB;AACAjC,cAAOG,WAAP,GAAqB,KAAKzG,YAAL,CAAkB,CAAlB,CAArB;AACAsG,cAAOE,cAAP,GAAwBqC,kCAAkCC,uBAA1D;AACA,WAAGN,QAAH,EAAY;AACX,aAAK9G,UAAL,CAAgBsH,IAAhB,CAAqB1C,MAArB;AACA,QAFD,MAGI;AACH,aAAK1H,IAAL,CAAUoK,IAAV,CAAe1C,MAAf;AACA,YAAGA,OAAOK,cAAP,CAAsB,OAAtB,CAAH,EAAmC;AAClC,cAAKR,SAAL,CAAeG,OAAOM,KAAP,CAAapG,IAA5B,EAAkCwI,IAAlC,CAAuC1C,MAAvC;AACA;AACD;AACD,OAbM,MAaA,IAAI,YAAYrD,OAAO+E,gBAAvB,EAAyC;AAC/C1B,cAAOE,cAAP,GAAwBqC,8BAAxB;AACA,WAAGvC,OAAOG,WAAP,IAAsB,YAAzB,EAAuC;AACtC,aAAKT,UAAL,CAAgBgD,IAAhB,CAAqB1C,MAArB;AACA,QAFD,MAGK;AACJ,aAAKP,OAAL,CAAaiD,IAAb,CAAkB1C,MAAlB;AACA;AACD,OARM,MAQA,IAAGkC,QAAH,EAAY;AAClB,YAAKnI,aAAL,CAAmB2I,IAAnB,CAAwB1C,MAAxB;AACA;AACD;;;wCAEkB/C,K,EAAON,M,EAAQ;AACjC;AACA,UAAIA,OAAOnC,YAAP,KAAwB,kBAA5B,EAAgD;AAC/C,WAAI7C,EAAEgL,QAAF,CAAW1F,KAAX,CAAJ,EAAuB;AACtB,YAAID,QAAS,OAAOL,OAAOK,KAAd,KAAwB,QAAzB,GAAqCL,OAAOK,KAA5C,GAAoD,MAAhE;AACA,YAAI4F,WAAW,KAAKC,aAAL,CAAmB5F,KAAnB,CAAf;AACA;AACA2F,mBAAY,OAAOjG,OAAOiG,QAAd,KAA2B,QAA5B,GAAwCE,KAAKjC,GAAL,CAASlE,OAAOiG,QAAhB,EAA0BA,QAA1B,CAAxC,GAA8EA,QAAzF;AACA3F,gBAAQnF,IAAIiL,YAAJ,CAAiB/F,KAAjB,EAAwBC,KAAxB,EAA+B2F,QAA/B,EAAyC,IAAzC,CAAR;AACA,QAND,MAMO;AACN3F,gBAAQ,gBAAR;AACA;AACD,OAVD,MAUO,IAAIN,OAAOnC,YAAP,KAAwB,kBAA5B,EAAgD;AACtD,WAAIyC,UAAUsB,SAAV,IAAuBtB,UAAU,IAAjC,IAAyCA,UAAUA,KAAvD,EACCA,QAAQ,gBAAR;AACD,OAHM,MAGA,IAAIN,OAAOnC,YAAP,KAAwB,gBAA5B,EAA8C;AACpD,WAAI7C,EAAEgL,QAAF,CAAW1F,KAAX,CAAJ,EAAuB;AACtB,YAAI+F,OAAOjL,OAAO,IAAI0C,IAAJ,CAASwC,KAAT,CAAP,CAAX;AACA,YAAI,KAAKgG,SAAL,CAAeC,aAAf,EAAJ,EAAoCF,OAAOA,KAAKG,GAAL,EAAP;AACpClG,gBAAQ+F,KAAKI,MAAL,CAAYzG,OAAO0G,UAAnB,CAAR;AACA,QAJD,MAIO;AACNpG,gBAAQ,cAAR;AACA;AACD;AACD,aAAOA,KAAP;AACA;;;mCAEaqG,G,EAAK;AAClB,UAAIpH,QAAQ,CAAC,KAAGoH,GAAJ,EAASpH,KAAT,CAAe,kCAAf,CAAZ;AACA,UAAI,CAACA,KAAL,EAAY;AAAE,cAAO,CAAP;AAAW;AACzB,aAAO4G,KAAKrC,GAAL,CACN,CADM;AAEN;AACA,OAACvE,MAAM,CAAN,IAAWA,MAAM,CAAN,EAASL,MAApB,GAA6B,CAA9B;AACA;AACGK,YAAM,CAAN,IAAW,CAACA,MAAM,CAAN,CAAZ,GAAuB,CAF1B,CAHM,CAAP;AAMA;;;0CAEoB8D,M,EAAQrD,M,EAAQ;AACpCqD,aAAOG,WAAP,GAAqB,KAAKzG,YAAL,CAAkB,CAAlB,CAArB;AACAsG,aAAOuD,aAAP,GAAuB5G,OAAO4G,aAA9B;;AAEA,UAAIvD,OAAOiB,aAAP,IAAwBjB,OAAOuD,aAAnC,EAAkD;AACjD,YAAK/D,QAAL,CAAckD,IAAd,CAAmB1C,MAAnB;AACA;AACD;;;oCAEcA,M,EAAQrD,M,EAAQ;AAC9B,UAAGqD,OAAOG,WAAP,IAAsB,YAAzB,EAAuC;AACtC,YAAKT,UAAL,CAAgBgD,IAAhB,CAAqB1C,MAArB;AACA,OAFD,MAEO;AACN,YAAKP,OAAL,CAAaiD,IAAb,CAAkB1C,MAAlB;AACA;AACD;;;wCAEkB;AAClB,UAAG,KAAK1D,UAAR,EAAoB;AACnB,YAAKkH,UAAL,GAAkB,aAAlB;AACA,OAFD,MAEO,IAAI,KAAKhE,QAAL,CAAc3D,MAAd,GAAuB,CAA3B,EAA8B;AACpC,YAAK2H,UAAL,GAAkB,gBAAlB;AACA,OAFM,MAEA,IAAI,KAAKrI,UAAL,CAAgBU,MAAhB,GAAyB,CAA7B,EAAgC;AACtC,YAAK2H,UAAL,GAAkB,aAAlB;AACA,OAFM,MAEA,IAAI,KAAKpI,UAAL,CAAgBS,MAAhB,GAAyB,CAA7B,EAAgC;AACtC,YAAK2H,UAAL,GAAkB,YAAlB;AACA,OAFM,MAEA,IAAG,CAAC,KAAKxD,MAAL,IAAezB,SAAf,IAA4B,KAAKyB,MAAL,CAAYnE,MAAZ,IAAsB,CAAnD,KAAyD,KAAKvC,KAAL,CAAWb,cAAvE,EAAuF;AAC7F,YAAK+K,UAAL,GAAkB,eAAlB;AACA,OAFM,MAEA;AACN,YAAKA,UAAL,GAAkB,UAAlB;AACA;AACD;;;wCAEkB;AAClB,WAAKnG,eAAL,CAAqBkC,WAArB,CAAiC,8DAAjC;AACA,WAAKlC,eAAL,CAAqBiC,QAArB,CAA8B,KAAKkE,UAAnC;;AAEA,UAAIC,SAAS9L,EAAE+D,QAAF,CAAW,KAAKpC,KAAL,CAAWV,YAAtB,IAAsC,KAAKU,KAAL,CAAWV,YAAjD,GAAgE,CAA7E;AACA,WAAKyE,eAAL,CAAqBE,GAArB,CAAyB,eAAzB,EAA0CkG,SAAS,GAAnD;;AAEA,UAAIC,UAAW,KAAKpK,KAAL,CAAWZ,gBAAZ,GAAgC,EAAhC,GAAqC,KAAKY,KAAL,CAAWlB,MAAX,CAAkBG,EAArE;;AAEA,UAAI,KAAKe,KAAL,CAAWnB,SAAX,KAAyB,OAA7B,EAAsC;AACrC,eAAO,KAAKqL,UAAZ;AACC,aAAK,gBAAL;AAAuB,cAAKnG,eAAL,CAAqBE,GAArB,CAAyB,kBAAzB,EAA6C,KAAKjE,KAAL,CAAWlB,MAAX,CAAkBI,OAA/D,EAAyE;AAChG,aAAK,aAAL;AAAoB,cAAK6E,eAAL,CAAqBE,GAArB,CAAyB,kBAAzB,EAA6C,KAAKjE,KAAL,CAAWlB,MAAX,CAAkBC,IAA/D,EAAsE;AAC1F,aAAK,YAAL;AAAmB,cAAKgF,eAAL,CAAqBE,GAArB,CAAyB,kBAAzB,EAA6C,KAAKjE,KAAL,CAAWlB,MAAX,CAAkBE,IAA/D,EAAsE;AACzF,aAAK,eAAL;AAAsB,cAAK+E,eAAL,CAAqBE,GAArB,CAAyB,kBAAzB,EAA6C,KAAKjE,KAAL,CAAWlB,MAAX,CAAkBI,OAA/D,EAAyE;AAC/F;AAAS,cAAK6E,eAAL,CAAqBE,GAArB,CAAyB,kBAAzB,EAA6CmG,OAA7C,EAAuD;AALjE;AAOA,OARD,MAQO;AACN,YAAKrG,eAAL,CAAqBE,GAArB,CAAyB,kBAAzB,EAA6C,EAA7C;AACA;AACD;;;6CAEuB;AAAA;;AACvB,UAAG,KAAKjE,KAAL,CAAWqK,cAAX,IAA6B,IAA7B,IAAqC,KAAKrK,KAAL,CAAWqK,cAAX,IAA6B,CAArE,EAAwE;AACvE,WAAIC,0BAA0B,KAAKtK,KAAL,CAAWqK,cAAzC;AACA,WAAIE,oBAAoB,CAAxB;AACA,WAAIC,oBAAoB,CAAC,UAAD,EAAa,MAAb,EAAqB,MAArB,EAA6B,SAA7B,CAAxB;AACAA,yBAAkB/D,OAAlB,CAA2B,qBAAa;AACvC,YAAIgE,mBAAmB,OAAKC,SAAL,EAAgBnI,MAAvC;AACA,eAAKmI,SAAL,IAAkB,OAAKA,SAAL,EAAgBhG,KAAhB,CAAsB,CAAtB,EAAwB4F,uBAAxB,CAAlB;AACAA,kCAA0Bd,KAAKrC,GAAL,CAASmD,0BAA0B,OAAKI,SAAL,EAAgBnI,MAAnD,EAA2D,CAA3D,CAA1B;AACAgI,6BAAsBE,mBAAmB,OAAKC,SAAL,EAAgBnI,MAAzD;AACA,QALD;;AAOA,WAAGgI,oBAAoB,CAAvB,EAA0B;AACzB,aAAKlE,eAAL,GAAuB,OAAOkE,iBAAP,GAA2B,OAAlD;AACA;AACD;AACD;;;gCAEU;AACV,UAAI,KAAKvK,KAAL,CAAW2K,KAAX,IAAoB,KAAK3K,KAAL,CAAW2K,KAAX,CAAiBpI,MAAjB,GAA0B,CAAlD,EAAqD;AACpD,WAAIqI,OAAO,KAAK5K,KAAL,CAAW2K,KAAX,CAAiB,CAAjB,CAAX;;AAEA,WAAIC,KAAKC,IAAL,IAAa,UAAjB,EAA6B;AAC5B,aAAKC,GAAL,GAAWF,KAAK9J,GAAhB;AACA,QAFD,MAEO;AACN,aAAKgK,GAAL,GAAW,eAAeF,KAAKG,OAA/B;AACA;;AAED,WAAIH,KAAKI,MAAT,EAAiB;AAChB,aAAKF,GAAL,IAAa,MAAMF,KAAKI,MAAxB;AACA;;AAED,YAAKC,WAAL,GAAmBL,KAAKK,WAAxB;AACA,OAdD,MAcO;AACN,YAAKH,GAAL,GAAW7F,SAAX;AACA;AACD;;;mCAEa3C,S,EAAW;AACxB,UAAGA,aAAa,IAAb,IAAqBA,UAAUC,MAAV,IAAoB,CAA5C,EAA+C;AAC9C,cAAO,IAAP;AACA;AACD,UAAI;AACH,WAAIC,QAAQ,IAAIC,MAAJ,CAAWH,SAAX,CAAZ;AACA,cAAO,IAAP;AACA,OAHD,CAGE,OAAMI,CAAN,EAAS;AACV,cAAO,KAAP;AACA;AACD;;;oCAsCcwI,Q,EAAU;AACxB,WAAKxE,MAAL,GAAcwE,SAASC,GAAT,CAAa3L,iBAAiB4L,aAAjB,CAA+B7J,IAA/B,CAAoC,IAApC,CAAb,CAAd;AACA,WAAKqC,MAAL;AACA;;;mCAEa;AACb,WAAK7E,IAAL,GAAY,EAAZ;AACA,WAAKC,IAAL,GAAY,EAAZ;AACA,WAAKsH,SAAL,GAAiB,EAAjB;AACA,WAAKC,SAAL,GAAiB,EAAjB;AACA;;;kCAaY;AACZ,UAAG,KAAK8E,SAAR,EAAmBC,cAAc,KAAKD,SAAnB;AACnB;;;gCAEU;AAAA;;AACV,UAAI,KAAKA,SAAT,EAAoBC,cAAc,KAAKD,SAAnB;AACpB,UAAI,KAAKrL,KAAL,CAAWrB,QAAX,KAAwB,KAAKI,IAAL,CAAUwD,MAAV,GAAmB,CAAnB,IAAwB,KAAKvD,IAAL,CAAUuD,MAAV,GAAmB,CAA3C,IAAgD,KAAK2D,QAAL,CAAc3D,MAAd,GAAuB,CAA/F,CAAJ,EAAuG;AACtG,YAAK8I,SAAL,GAAiBE,YAAY,YAAM;AAClC,eAAKxH,eAAL,CAAqByH,WAArB,CAAiC,SAAjC;AACA,QAFgB,EAEd,KAAKxL,KAAL,CAAWpB,QAAX,GAAsB,IAFR,CAAjB;AAGA;AACD;;;0BAEI6M,K,EAAOC,I,EAAMC,K,EAAOC,I,EAAM;AAC9B,WAAK7H,eAAL,GAAuB2H,KAAK1H,IAAL,CAAU,kBAAV,CAAvB;AACA,WAAKD,eAAL,CAAqBiC,QAArB,CAA8B,SAA9B;AACA,WAAK9B,eAAL,GAAuB0H,IAAvB;AACA;;;gCAES;AAAA;;AACT,UAAG,KAAK5L,KAAL,CAAW6L,SAAd,EAAwB;AACvB,WAAIC,YAAY,KAAhB;AACA,YAAK9L,KAAL,CAAWU,YAAX,CAAwB+F,OAAxB,CAAgC,mBAAW;AAC1C,YAAG7B,QAAQhE,IAAR,KAAiB,OAAKZ,KAAL,CAAW6L,SAA/B,EAAyC;AACxCC,qBAAY,IAAZ;AACA;AACD,QAJD;AAKA,WAAG,CAACA,SAAJ,EAAc;AACb,aAAK9L,KAAL,CAAWU,YAAX,CAAwB0I,IAAxB,CAA6B,EAACxI,MAAM,KAAKZ,KAAL,CAAW6L,SAAlB,EAA6BhL,OAAO,EAApC,EAAwCC,KAAK,EAA7C,EAA7B;AACA,aAAKd,KAAL,CAAW6L,SAAX,GAAuB,EAAvB;AACA;AACD;AACD,WAAKjI,MAAL;AACA;;;iCAEWoD,K,EAAM;AACjB,WAAKhH,KAAL,CAAWU,YAAX,GAA0BrC,EAAE0N,OAAF,CAAU,KAAK/L,KAAL,CAAWU,YAArB,EAAmCsG,KAAnC,CAA1B;AACA,WAAKpD,MAAL;AACA;;;iCAEWoI,I,EAAMC,K,EAAOC,M,EAAO;AAC/B,aAAOF,KAAKlG,OAAL,CAAa,KAAb,EAAoBmG,KAApB,EAA2BnG,OAA3B,CAAmC,KAAnC,EAA0CoG,MAA1C,CAAP;AACA;;;qCArGsBC,a,EAAe;AACrC,UAAI/I,MAAM,EAAV;;AAEA,UAAI5D,iBAAiB8I,OAAjB,CAAyB6D,cAAcnN,IAAvC,CAAJ,EAAkD;AACjDoE,WAAIpE,IAAJ,GAAWoN,WAAWD,cAAcnN,IAAzB,CAAX;AACAoE,WAAI0F,YAAJ,GAAmB,IAAnB;AACA,OAHD,MAGO,IAAIqD,cAAcnN,IAAd,YAA8BmC,IAAlC,EAAwC;AAC9C;AACAiC,WAAIpE,IAAJ,GAAWmN,cAAcnN,IAAd,CAAmBqN,OAAnB,EAAX;AACAjJ,WAAI0F,YAAJ,GAAmB,IAAnB;AACA,OAJM,MAIA;AACN1F,WAAIpE,IAAJ,GAAWmN,cAAcnN,IAAzB;AACAoE,WAAI0F,YAAJ,GAAmB,KAAnB;AACA;;AAED,UAAItJ,iBAAiB8I,OAAjB,CAAyB6D,cAAcpN,IAAvC,CAAJ,EAAkD;AACjDqE,WAAIrE,IAAJ,GAAWqN,WAAWD,cAAcpN,IAAzB,CAAX;AACAqE,WAAI2F,YAAJ,GAAmB,IAAnB;AACA,OAHD,MAGO,IAAIoD,cAAcpN,IAAd,YAA8BoC,IAAlC,EAAwC;AAC9CiC,WAAIrE,IAAJ,GAAWoN,cAAcpN,IAAd,CAAmBsN,OAAnB,EAAX;AACAjJ,WAAI2F,YAAJ,GAAmB,IAAnB;AACA,OAHM,MAGA;AACN3F,WAAIrE,IAAJ,GAAWoN,cAAcpN,IAAzB;AACAqE,WAAI2F,YAAJ,GAAmB,KAAnB;AACA;;AAED,aAAO3F,GAAP;AACA;;;6BAEckJ,G,EAAK;AACnB,UAAI,CAAC9H,MAAM8H,GAAN,CAAD,IAAeA,IAAIC,QAAJ,GAAeC,WAAf,GAA6BC,OAA7B,CAAqC,GAArC,KAA6C,CAAC,CAAjE,EAAoE;AACnE,cAAO,IAAP;AACA;AACD,aAAO,KAAP;AACA;;;mCAcoBC,U,EAAY;AAChC,UAAIhG,SAAS,IAAIpI,UAAJ,CAAe;AAC3B8I,mBAAYsF,WAAWtF,UADI;AAE3BvG,cAAO6L,WAAWrJ;AAFS,OAAf,CAAb;;AAKAqD,aAAOiG,SAAP,GAAmBjG,OAAOkG,YAAP,CAAoB,WAApB,CAAnB;;AAEA,aAAOlG,MAAP;AACA;;;;KArpBoCtI,gB;;;;AAosBtCoB,oBAAiBqN,WAAjB,GAA+B,aAA/B","file":"status_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from \"app/plugins/sdk\";\nimport _ from \"lodash\";\nimport TimeSeries from \"app/core/time_series2\";\nimport coreModule from \"app/core/core_module\";\nimport kbn from \"app/core/utils/kbn\";\nimport moment from \"moment\";\n\nimport './css/status_panel.css!';\n\n// Set and populate panel defaults\nconst panelDefaults = {\n\tflipCard: false,\n\tflipTime: 5,\n\tcolorMode: 'Panel',\n\t// Changed colors to match Table Panel so colorised text is easier to read\n\tcolors: {\n\t\tcrit: 'rgba(245, 54, 54, 0.9)',\n\t\twarn: 'rgba(237, 129, 40, 0.9)',\n\t\tok: 'rgba(50, 128, 45, 0.9)',\n\t\tdisable: 'rgba(128, 128, 128, 0.9)'\n\t},\n\tisGrayOnNoData: false,\n\tisIgnoreOKColors: false,\n\tisHideAlertsOnDisable: false,\n\tcornerRadius: 0,\n\tisAutoScrollOnOverflow: false\n};\n\nexport class StatusPluginCtrl extends MetricsPanelCtrl {\n\t/** @ngInject */\n\tconstructor($scope, $injector, $log, $filter, annotationsSrv, uiSegmentSrv) {\n\t\tsuper($scope, $injector);\n\t\t_.defaultsDeep(this.panel, panelDefaults);\n\n\t\t//this.log = $log.debug;\n\t\tthis.filter = $filter;\n\n\t\tthis.valueHandlers = ['Number Threshold', 'String Threshold', 'Date Threshold', 'Disable Criteria', 'Text Only'];\n\t\tthis.aggregations = ['Last', 'First', 'Max', 'Min', 'Sum', 'Avg', 'Delta'];\n\t\tthis.displayTypes = ['Regular', 'Annotation'];\n\t\tthis.displayAliasTypes = ['Warning / Critical', 'Always'];\n\t\tthis.displayValueTypes = ['Never', 'When Alias Displayed', 'Warning / Critical', 'Critical Only'];\n\t\tthis.colorModes = ['Panel', 'Metric', 'Disabled'];\n\t\tthis.fontFormats = ['Regular', 'Bold', 'Italic'];\n\t\tthis.statusMetrics = [];\n\n\t\t//Push the default status check group\n\t\tif(!this.panel.statusGroups) {\n\t\t\tthis.panel.statusGroups = [];\n\t\t\tthis.panel.statusGroups.unshift({name: 'Status Checks', alias: '', url: ''});\n\t\t}\n\n\t\t// Dates get stored as strings and will need to be converted back to a Date objects\n\t\t_.each(this.panel.targets, (t) => {\n\t\t\tif (t.valueHandler === \"Date Threshold\") {\n\t\t\t\tif (typeof t.crit != \"undefined\") t.crit = new Date(t.crit);\n\t\t\t\tif (typeof t.warn != \"undefined\") t.warn = new Date(t.warn);\n\t\t\t}\n\t\t});\n\n\t\tthis.panel.flipTime = this.panel.flipTime || 5;\n\n\t\t/** Bind events to functions **/\n\t\tthis.events.on('render', this.onRender.bind(this));\n\t\tthis.events.on('refresh', this.postRefresh.bind(this));\n\t\tthis.events.on('data-error', this.onDataError.bind(this));\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\n\t\tthis.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\n\t\tthis.onColorChange = this.onColorChange.bind(this);\n\n\t\tthis.statusCrit = [];\n\t\tthis.statusWarn = [];\n\t\tthis.statusMetric = null;\n\n\t\tthis.addFilters()\n\t}\n\n\taddFilters() {\n\t\tcoreModule.filter('numberOrText', () => {\n\t\t\tlet numberOrTextFilter = (input) => {\n\t\t\t\tif(angular.isNumber(input)) {\n\t\t\t\t\treturn this.filter('number')(input);\n\t\t\t\t} else {\n\t\t\t\t\treturn input;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tnumberOrTextFilter.$stateful = true;\n\t\t\treturn numberOrTextFilter;\n\t\t});\n\n\t\tcoreModule.filter('numberOrTextWithRegex', () => {\n\t\t\tlet numberOrTextFilter = (input, textRegex) => {\n\t\t\t\tif(angular.isNumber(input)) {\n\t\t\t\t\treturn this.filter('number')(input);\n\t\t\t\t} else {\n\t\t\t\t\tif(textRegex == null || textRegex.length == 0) {\n\t\t\t\t\t\treturn input;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet regex;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tregex = new RegExp(textRegex);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\treturn input;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!input) {\n\t\t\t\t\t\t\treturn input;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet matchResults = input.match(regex);\n\t\t\t\t\t\tif (matchResults == null) {\n\t\t\t\t\t\t\treturn input;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn matchResults[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tnumberOrTextFilter.$stateful = true;\n\t\t\treturn numberOrTextFilter;\n\t\t});\n\t}\n\n\tpostRefresh() {\n\t\tif (this.panel.fixedSpan) {\n\t\t\tthis.panel.span = this.panel.fixedSpan;\n\t\t}\n\n\t\tthis.measurements = this.panel.targets;\n\n\t\t/** Duplicate alias validation **/\n\t\tthis.duplicates = false;\n\n\t\tthis.measurements = _.filter(this.measurements, (measurement) => {\n\t\t\treturn !measurement.hide;\n\t\t});\n\n\t\t_.each(this.measurements, (m) => {\n\t\t\tlet res = _.filter(this.measurements, (measurement) => {\n\t\t\t\treturn (m.alias == measurement.alias || (m.target == measurement.target && m.target)) && !m.hide;\n\t\t\t});\n\n\t\t\tif (res.length > 1) {\n\t\t\t\tthis.duplicates = true;\n\t\t\t}\n\t\t});\n\t}\n\n\tonInitEditMode() {\n\t\tthis.addEditorTab('Options', 'public/plugins/blackmirror1-statusbygroup-panel/editor.html', 2);\n\t\t// Load in the supported units-of-measure formats so they can be displayed in the editor\n\t\tthis.unitFormats = kbn.getUnitFormats();\n\t}\n\n\tsetUnitFormat(measurement, subItem) {\n\t\tmeasurement.units = subItem.value;\n\t\tthis.render();\n\t}\n\n\tfixPanelHeader() {\n\t\t// Handle the panel top menu height, since it's display doesn't look good with the panel\n\t\tlet panelHeaderHeight = '';\n\t\tif(this.panel.title.length === 0) {\n\t\t\tpanelHeaderHeight = '10px';\n\t\t}\n\t\tthis.$panelContainer.find('.panel-header').css('height', panelHeaderHeight);\n\t\tthis.$panelContainer.find('.panel-menu-container').css('height', panelHeaderHeight);\n\t\tthis.$panelContainer.find('.fa-caret-down').css('display', 'none');\n\t}\n\n\tsetElementHeight() {\n\t\t// Handle the panel height\n\t\tthis.$panelContainer.find('.status-panel').css('min-height', this.$panelContoller.height + 'px');\n\t\tthis.minHeight = this.$panelContoller.height-10;\n\t}\n\n\tsetTextMaxWidth() {\n\t\tlet tail = ' â€¦';\n\t\tlet panelWidth = this.$panelContainer.innerWidth();\n\t\tif (isNaN(panelWidth))\n\t\t\tpanelWidth = parseInt(panelWidth.slice(0, -2), 10) / 12;\n\t\tpanelWidth = panelWidth - 20;\n\t\tthis.maxWidth = panelWidth;\n\t}\n\n\tisAutoScrollAlerts() {\n\t\tif(!this.panel.isAutoScrollOnOverflow) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet element = this.$panelContainer.find('.status-panel')[0];\n\t\tlet overflowY = element.offsetHeight < element.scrollHeight;\n\t\treturn overflowY;\n\t}\n\n\tonHandlerChange(measurement) {\n\t\t// If the Threshold type changes between Number/String/Date then try and recast the thresholds to keep consistent\n\t\tif (measurement.valueHandler === \"Number Threshold\") {\n\t\t\tmeasurement.crit = (isNaN(Number(measurement.crit))) ? undefined : Number(measurement.crit);\n\t\t\tmeasurement.warn = (isNaN(Number(measurement.warn))) ? undefined : Number(measurement.warn);\n\t\t} else if (measurement.valueHandler === \"String Threshold\") {\n\t\t\tif (typeof measurement.crit != \"undefined\") measurement.crit = String(measurement.crit);\n\t\t\tif (typeof measurement.warn != \"undefined\") measurement.warn = String(measurement.warn);\n\t\t} else if (measurement.valueHandler === \"Date Threshold\") {\n\t\t\tlet c = new Date(measurement.crit), w = new Date(measurement.warn);\n\t\t\tmeasurement.crit = (isNaN(c.getTime())) ? undefined : c;\n\t\t\tmeasurement.warn = (isNaN(w.getTime())) ? undefined : w;\n\t\t}\n\t\tthis.onRender();\n\t}\n\n\tonColorChange(item) {\n\t\treturn (color) => {\n\t\t\tthis.panel.colors[item] = color;\n\t\t\tthis.render();\n\t\t};\n\t}\n\n\tonRender() {\n\t\tthis.fixPanelHeader();\n\t\tthis.setElementHeight();\n\t\tthis.setTextMaxWidth();\n\t\tthis.upgradeOldVersion();\n\n\t\tif (this.panel.clusterName) {\n\t\t\tthis.panel.displayName =\n\t\t\t\tthis.filter('interpolateTemplateVars')(this.panel.clusterName, this.$scope)\n\t\t\t\t\t.replace(new RegExp(this.panel.namePrefix, 'i'), '');\n\t\t} else {\n\t\t\tthis.panel.displayName = \"\";\n\t\t}\n\n\t\tif(this.panel.flipCard){\n\t\t\tthis.$panelContainer.addClass(\"effect-hover\");\n\t\t} else {\n\t\t\tthis.$panelContainer.removeClass(\"effect-hover\");\n\t\t}\n\n\t\tlet targets = this.panel.targets;\n\n\t\tthis.crit = [];\n\t\tthis.warn = [];\n\t\tthis.statusCrit = [];\n\t\tthis.statusWarn = [];\n\t\tthis.disabled = [];\n\t\tthis.display = [];\n\t\tthis.annotation = [];\n\t\tthis.extraMoreAlerts = null;\n\n\t\tthis.statusMetrics = [];\n\t\tthis.groupCrit = {};\n\t\tthis.groupWarn = {};\n\n\t\tif(this.panel.statusGroups){\n\t\t\tvar statusGroupExists = false;\n\t\t\tthis.panel.statusGroups.forEach(element => {\n\t\t\t\tthis.groupCrit[element.name] = [];\n\t\t\t\tthis.groupWarn[element.name] = [];\n\t\t\t\tif(element.name === 'Status Checks'){\n\t\t\t\t\tstatusGroupExists = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif(!statusGroupExists){\n\t\t\t\tthis.panel.statusGroups.unshift({name: 'Status Checks', alias: '', url: ''})\n\t\t\t}\n\t\t}\n\n\t\t_.each(this.series, (s) => {\n\t\t\tlet target = _.find(targets, (target) => {\n\t\t\t\treturn target.alias == s.alias || target.target == s.alias;\n\t\t\t});\n\n\t\t\tif (!target) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ts.alias = target.alias;\n\t\t\ts.url = target.url;\n\t\t\ts.isDisplayValue = true;\n\t\t\ts.displayType = target.displayType;\n\t\t\ts.valueDisplayRegex = \"\";\n\t\t\tif(this.panel.statusGroups){\n\t\t\t\tthis.panel.statusGroups.forEach(element => {\n\t\t\t\t\tif(target.hasOwnProperty('group') && element.name === target.group.name){\n\t\t\t\t\t\ts.group = element;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t// s.group = target.group;\n\n\t\t\tif(this.validateRegex(target.valueDisplayRegex)) {\n\t\t\t\ts.valueDisplayRegex = target.valueDisplayRegex;\n\t\t\t}\n\n\t\t\tlet value;\n\t\t\tswitch (target.aggregation) {\n\t\t\t\tcase 'Max':\n\t\t\t\t\tvalue = _.max(s.datapoints, (point) => { return point[0]; })[0];\n\t\t\t\t\tvalue = s.stats.max;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Min':\n\t\t\t\t\tvalue = _.min(s.datapoints, (point) => { return point[0]; })[0];\n\t\t\t\t\tvalue = s.stats.min;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Delta':\n\t\t\t\t\tvalue = s.datapoints[s.datapoints.length - 1][0] - s.datapoints[0][0];\n\t\t\t\t\tvalue = s.stats.diff;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Sum':\n\t\t\t\t\tvalue = 0;\n\t\t\t\t\t_.each(s.datapoints, (point) => { value += point[0] });\n\t\t\t\t\tvalue = s.stats.total;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Avg':\n\t\t\t\t\tvalue = s.stats.avg;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'First':\n\t\t\t\t\tvalue = s.datapoints[0][0];\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tvalue = s.datapoints[s.datapoints.length - 1][0];\n\t\t\t}\n\n\t\t\ts.display_value = value;\n\n\t\t\tif (target.valueHandler == \"Number Threshold\" ||\n\t\t\t\ttarget.valueHandler == \"String Threshold\" ||\n\t\t\t\ttarget.valueHandler == \"Date Threshold\") {\n\t\t\t\tthis.handleThresholdStatus(s, target);\n\t\t\t}\n\t\t\telse if (target.valueHandler == \"Disable Criteria\") {\n\t\t\t\tthis.handleDisabledStatus(s,target);\n\t\t\t}\n\t\t\telse if (target.valueHandler == \"Text Only\") {\n\t\t\t\tthis.handleTextOnly(s, target);\n\t\t\t}\n\n\t\t\t// this.statusMetrics.push(s.alias)\n\t\t});\n\n\t\tif(this.panel.isHideAlertsOnDisable && this.disabled.length > 0) {\n\t\t\tthis.crit = [];\n\t\t\tthis.warn = [];\n\t\t\tthis.groupCrit = {};\n\t\t\tthis.groupWarn = {};\n\t\t\tthis.display = [];\n\t\t}\n\n\t\tthis.autoFlip();\n\t\tthis.updatePanelState();\n\t\tthis.handleCssDisplay();\n\t\tthis.parseUri();\n\n\t\t//This must appear after handling the css style of the panel\n\t\tthis.handleMaxAlertsToShow();\n\t}\n\n\tupgradeOldVersion() {\n\t\tlet targets = this.panel.targets;\n\n\t\t//Handle legacy code\n\t\t_.each(targets, (target) => {\n\t\t\tif(target.valueHandler == null) {\n\t\t\t\tif(target.displayType != null) {\n\t\t\t\t\ttarget.valueHandler = target.displayType;\n\t\t\t\t\tif (target.valueHandler == \"Annotation\") {\n\t\t\t\t\t\ttarget.valueHandler = \"Text Only\"\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttarget.valueHandler = this.valueHandlers[0]\n\t\t\t\t}\n\t\t\t\ttarget.displayType = this.displayTypes[0];\n\t\t\t}\n\n\t\t\tif(target.display != null){\n\t\t\t\ttarget.displayAliasType = target.display ? \"Always\" : this.displayAliasTypes[0];\n\t\t\t\ttarget.displayValueWithAlias = target.display ? 'When Alias Displayed' : this.displayValueTypes[0];\n\t\t\t\tdelete target.display;\n\n\t\t\t}\n\t\t});\n\n\t\t// Depreciate Threshold in favour of Type specific versions\n\t\t_.each(targets, (target) => {\n\t\t\tif (target.valueHandler === \"Threshold\") {\n\t\t\t\t// Use the same logic as Threshold Parsing to ensure we retain same behaviour\n\t\t\t\t// i.e. map to Number Threshold if two floats (i.e. range check) otherwise map to String Threshold (i.e. exact match)\n\t\t\t\tif (StatusPluginCtrl.isFloat(target.crit) && StatusPluginCtrl.isFloat(target.warn)) {\n\t\t\t\t\ttarget.valueHandler = \"Number Threshold\"\n\t\t\t\t\ttarget.crit = Number(target.crit);\n\t\t\t\t\ttarget.warn = Number(target.warn);\n\t\t\t\t} else {\n\t\t\t\t\ttarget.valueHandler = \"String Threshold\"\n\t\t\t\t\tif (typeof target.crit != \"undefined\") target.crit = String(target.crit);\n\t\t\t\t\tif (typeof target.warn != \"undefined\") target.warn = String(target.warn);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thandleThresholdStatus(series, target) {\n\t\tseries.thresholds = StatusPluginCtrl.parseThresholds(target);\n\t\tseries.inverted = series.thresholds.crit < series.thresholds.warn;\n\n\t\tlet isCritical = false;\n\t\tlet isWarning = false;\n\t\tlet isStatus = false;\n\t\tlet isCheckRanges = series.thresholds.warnIsNumber && series.thresholds.critIsNumber;\n\n\t\t// alert(series.alias);\n\n\t\tif (series.hasOwnProperty('group') && series.group === this.panel.statusGroups[0]){\n\t\t\tisStatus = true;\n\t\t\t// this.statusMetrics.push(series);\n\t\t}\n\n\t\tif (isCheckRanges) {\n\t\t\tif (!series.inverted) {\n\t\t\t\tif (series.display_value >= series.thresholds.crit) {\n\t\t\t\t\tisCritical = true\n\t\t\t\t} else if (series.display_value >= series.thresholds.warn) {\n\t\t\t\t\tisWarning = true\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (series.display_value <= series.thresholds.crit && series.alias) {\n\t\t\t\t\tisCritical = true\n\t\t\t\t} else if (series.display_value <= series.thresholds.warn) {\n\t\t\t\t\tisWarning = true\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (series.display_value == series.thresholds.crit && series.alias) {\n\t\t\t\tisCritical = true\n\t\t\t} else if (series.display_value == series.thresholds.warn) {\n\t\t\t\tisWarning = true\n\t\t\t}\n\t\t}\n\n\t\t// Add units-of-measure and decimal formatting or date formatting as needed\n\t\tseries.display_value = this.formatDisplayValue(series.display_value, target);\n\n\t\tlet displayValueWhenAliasDisplayed = 'When Alias Displayed' === target.displayValueWithAlias;\n\t\tlet displayValueFromWarning = 'Warning / Critical' === target.displayValueWithAlias;\n\t\tlet displayValueFromCritical = 'Critical Only' === target.displayValueWithAlias;\n\n\t\tif(isCritical) {\n\t\t\t//In critical state we don't show the error as annotation\n\t\t\tseries.displayType = this.displayTypes[0];\n\t\t\tseries.isDisplayValue = displayValueWhenAliasDisplayed || displayValueFromWarning || displayValueFromCritical;\n\t\t\tif(isStatus) {\n\t\t\t\tthis.statusCrit.push(series);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.crit.push(series);\n\t\t\t\tif(series.hasOwnProperty('group')) {\n\t\t\t\t\tthis.groupCrit[series.group.name].push(series);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if(isWarning) {\n\t\t\t//In warning state we don't show the warning as annotation\n\t\t\tseries.displayType = this.displayTypes[0];\n\t\t\tseries.isDisplayValue = displayValueWhenAliasDisplayed || displayValueFromWarning;\n\t\t\tif(isStatus){\n\t\t\t\tthis.statusWarn.push(series);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tthis.warn.push(series);\n\t\t\t\tif(series.hasOwnProperty('group')) {\n\t\t\t\t\tthis.groupWarn[series.group.name].push(series);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (\"Always\" == target.displayAliasType) {\n\t\t\tseries.isDisplayValue = displayValueWhenAliasDisplayed;\n\t\t\tif(series.displayType == \"Annotation\") {\n\t\t\t\tthis.annotation.push(series);\n\t\t\t} \n\t\t\telse {\n\t\t\t\tthis.display.push(series);\n\t\t\t}\n\t\t} else if(isStatus){\n\t\t\tthis.statusMetrics.push(series);\n\t\t}\n\t}\n\n\tformatDisplayValue(value, target) {\n\t\t// Format the display value. Set to \"Invalid\" if value is out-of-bounds or a type mismatch with the handler\n\t\tif (target.valueHandler === \"Number Threshold\") {\n\t\t\tif (_.isFinite(value)) {\n\t\t\t\tlet units = (typeof target.units === \"string\") ? target.units : 'none';\n\t\t\t\tlet decimals = this.decimalPlaces(value);\n\t\t\t\t// We define the decimal percision by the minimal decimal needed\n\t\t\t\tdecimals = (typeof target.decimals === \"number\") ? Math.min(target.decimals, decimals) : decimals;\n\t\t\t\tvalue = kbn.valueFormats[units](value, decimals, null);\n\t\t\t} else {\n\t\t\t\tvalue = \"Invalid Number\";\n\t\t\t}\n\t\t} else if (target.valueHandler === \"String Threshold\") {\n\t\t\tif (value === undefined || value === null || value !== value)\n\t\t\t\tvalue = \"Invalid String\";\n\t\t} else if (target.valueHandler === \"Date Threshold\") {\n\t\t\tif (_.isFinite(value)) {\n\t\t\t\tlet date = moment(new Date(value));\n\t\t\t\tif (this.dashboard.isTimezoneUtc()) date = date.utc();\n\t\t\t\tvalue = date.format(target.dateFormat);\n\t\t\t} else {\n\t\t\t\tvalue = \"Invalid Date\";\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t}\n\n\tdecimalPlaces(num) {\n\t\tvar match = (''+num).match(/(?:\\.(\\d+))?(?:[eE]([+-]?\\d+))?$/);\n\t\tif (!match) { return 0; }\n\t\treturn Math.max(\n\t\t\t0,\n\t\t\t// Number of digits right of decimal point.\n\t\t\t(match[1] ? match[1].length : 0)\n\t\t\t// Adjust for scientific notation.\n\t\t\t- (match[2] ? +match[2] : 0));\n\t}\n\n\thandleDisabledStatus(series, target) {\n\t\tseries.displayType = this.displayTypes[0];\n\t\tseries.disabledValue = target.disabledValue;\n\n\t\tif (series.display_value == series.disabledValue) {\n\t\t\tthis.disabled.push(series);\n\t\t}\n\t}\n\n\thandleTextOnly(series, target) {\n\t\tif(series.displayType == \"Annotation\") {\n\t\t\tthis.annotation.push(series);\n\t\t} else {\n\t\t\tthis.display.push(series);\n\t\t}\n\t}\n\n\tupdatePanelState() {\n\t\tif(this.duplicates) {\n\t\t\tthis.panelState = 'error-state';\n\t\t} else if (this.disabled.length > 0) {\n\t\t\tthis.panelState = 'disabled-state';\n\t\t} else if (this.statusCrit.length > 0) {\n\t\t\tthis.panelState = 'error-state';\n\t\t} else if (this.statusWarn.length > 0) {\n\t\t\tthis.panelState = 'warn-state';\n\t\t} else if((this.series == undefined || this.series.length == 0) && this.panel.isGrayOnNoData) {\n\t\t\tthis.panelState = 'no-data-state';\n\t\t} else {\n\t\t\tthis.panelState = 'ok-state';\n\t\t}\n\t}\n\n\thandleCssDisplay() {\n\t\tthis.$panelContainer.removeClass('error-state warn-state disabled-state ok-state no-data-state');\n\t\tthis.$panelContainer.addClass(this.panelState);\n\n\t\tlet radius = _.isNumber(this.panel.cornerRadius) ? this.panel.cornerRadius : 0\n\t\tthis.$panelContainer.css('border-radius', radius + '%');\n\n\t\tlet okColor = (this.panel.isIgnoreOKColors) ? '' : this.panel.colors.ok;\n\n\t\tif (this.panel.colorMode === \"Panel\") {\n\t\t\tswitch(this.panelState) {\n\t\t\t\tcase 'disabled-state': this.$panelContainer.css('background-color', this.panel.colors.disable); break;\n\t\t\t\tcase 'error-state': this.$panelContainer.css('background-color', this.panel.colors.crit); break;\n\t\t\t\tcase 'warn-state': this.$panelContainer.css('background-color', this.panel.colors.warn); break;\n\t\t\t\tcase 'no-data-state': this.$panelContainer.css('background-color', this.panel.colors.disable); break;\n\t\t\t\tdefault: this.$panelContainer.css('background-color', okColor); break;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.$panelContainer.css('background-color', '');\n\t\t}\n\t}\n\n\thandleMaxAlertsToShow() {\n\t\tif(this.panel.maxAlertNumber != null && this.panel.maxAlertNumber >= 0) {\n\t\t\tlet currentMaxAllowedAlerts = this.panel.maxAlertNumber;\n\t\t\tlet filteredOutAlerts = 0;\n\t\t\tlet arrayNamesToSlice = [\"disabled\", \"crit\", \"warn\", \"display\"];\n\t\t\tarrayNamesToSlice.forEach( arrayName => {\n\t\t\t\tlet originAlertCount = this[arrayName].length;\n\t\t\t\tthis[arrayName] = this[arrayName].slice(0,currentMaxAllowedAlerts);\n\t\t\t\tcurrentMaxAllowedAlerts = Math.max(currentMaxAllowedAlerts - this[arrayName].length, 0);\n\t\t\t\tfilteredOutAlerts += (originAlertCount - this[arrayName].length);\n\t\t\t});\n\n\t\t\tif(filteredOutAlerts > 0) {\n\t\t\t\tthis.extraMoreAlerts = \"+ \" + filteredOutAlerts + \" more\"\n\t\t\t}\n\t\t}\n\t}\n\n\tparseUri() {\n\t\tif (this.panel.links && this.panel.links.length > 0) {\n\t\t\tlet link = this.panel.links[0];\n\n\t\t\tif (link.type == \"absolute\") {\n\t\t\t\tthis.uri = link.url;\n\t\t\t} else {\n\t\t\t\tthis.uri = 'dashboard/' + link.dashUri;\n\t\t\t}\n\n\t\t\tif (link.params) {\n\t\t\t\tthis.uri +=  \"?\" + link.params;\n\t\t\t}\n\n\t\t\tthis.targetBlank = link.targetBlank;\n\t\t} else {\n\t\t\tthis.uri = undefined;\n\t\t}\n\t}\n\n\tvalidateRegex(textRegex) {\n\t\tif(textRegex == null || textRegex.length == 0) {\n\t\t\treturn true\n\t\t}\n\t\ttry {\n\t\t\tlet regex = new RegExp(textRegex);\n\t\t\treturn true\n\t\t} catch(e) {\n\t\t\treturn false\n\t\t}\n\t}\n\n\tstatic parseThresholds(metricOptions) {\n\t\tlet res = {};\n\n\t\tif (StatusPluginCtrl.isFloat(metricOptions.warn)) {\n\t\t\tres.warn = parseFloat(metricOptions.warn);\n\t\t\tres.warnIsNumber = true;\n\t\t} else if (metricOptions.warn instanceof Date) {\n\t\t\t// Convert Dates to Numbers and leverage existing threshold logic\n\t\t\tres.warn = metricOptions.warn.valueOf();\n\t\t\tres.warnIsNumber = true;\n\t\t} else {\n\t\t\tres.warn = metricOptions.warn;\n\t\t\tres.warnIsNumber = false;\n\t\t}\n\n\t\tif (StatusPluginCtrl.isFloat(metricOptions.crit)) {\n\t\t\tres.crit = parseFloat(metricOptions.crit);\n\t\t\tres.critIsNumber = true;\n\t\t} else if (metricOptions.crit instanceof Date) {\n\t\t\tres.crit = metricOptions.crit.valueOf();\n\t\t\tres.critIsNumber = true;\n\t\t} else {\n\t\t\tres.crit = metricOptions.crit;\n\t\t\tres.critIsNumber = false;\n\t\t}\n\n\t\treturn res;\n\t}\n\n\tstatic isFloat(val) {\n\t\tif (!isNaN(val) && val.toString().toLowerCase().indexOf('e') == -1) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tonDataReceived(dataList) {\n\t\tthis.series = dataList.map(StatusPluginCtrl.seriesHandler.bind(this));\n\t\tthis.render();\n\t}\n\n\tonDataError() {\n\t\tthis.crit = [];\n\t\tthis.warn = [];\n\t\tthis.groupCrit = {};\n\t\tthis.groupWarn = {};\n\t}\n\n\tstatic seriesHandler(seriesData) {\n\t\tvar series = new TimeSeries({\n\t\t\tdatapoints: seriesData.datapoints,\n\t\t\talias: seriesData.target\n\t\t});\n\n\t\tseries.flotpairs = series.getFlotPairs(\"connected\");\n\n\t\treturn series;\n\t}\n\n\t$onDestroy() {\n\t\tif(this.timeoutId) clearInterval(this.timeoutId);\n\t}\n\n\tautoFlip() {\n\t\tif (this.timeoutId) clearInterval(this.timeoutId);\n\t\tif (this.panel.flipCard && (this.crit.length > 0 || this.warn.length > 0 || this.disabled.length > 0)) {\n\t\t\tthis.timeoutId = setInterval(() => {\n\t\t\t\tthis.$panelContainer.toggleClass(\"flipped\");\n\t\t\t}, this.panel.flipTime * 1000);\n\t\t}\n\t}\n\n\tlink(scope, elem, attrs, ctrl) {\n\t\tthis.$panelContainer = elem.find('.panel-container');\n\t\tthis.$panelContainer.addClass(\"st-card\");\n\t\tthis.$panelContoller = ctrl;\n\t}\n\n\taddGroup(){\n\t\tif(this.panel.groupname){\n\t\t\tvar duplicate = false;\n\t\t\tthis.panel.statusGroups.forEach(element => {\n\t\t\t\tif(element.name === this.panel.groupname){\n\t\t\t\t\tduplicate = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif(!duplicate){\n\t\t\t\tthis.panel.statusGroups.push({name: this.panel.groupname, alias: '', url: ''});\n\t\t\t\tthis.panel.groupname = '';\n\t\t\t}\n\t\t}\n\t\tthis.render();\n\t}\n\n\tremoveGroup(group){\n\t\tthis.panel.statusGroups = _.without(this.panel.statusGroups, group);\n\t\tthis.render();\n\t}\n\n\tformatAlias(text, count, status){\n\t\treturn text.replace('{c}', count).replace('{s}', status);\n\t}\n}\n\nStatusPluginCtrl.templateUrl = 'module.html';\n"]}