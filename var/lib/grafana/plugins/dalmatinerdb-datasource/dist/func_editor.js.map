{"version":3,"sources":["../src/func_editor.js"],"names":["_","$","angular","KEY_ESC","KEY_ENTER","module","directive","$compile","templateSrv","tmplLabel","tmplArg","tmplTools","restrict","link","postLink","$scope","el","$tmplLabel","$tmplTools","ctrl","func","addElementsAndCompile","appendTo","each","args","arg","argIndex","argValue","highlightVariablesAsHtml","$argField","$argLabel","blur","partial","onArgEditDone","keyup","onArgKeyPress","click","onArgLabelClick","contents","$label","$field","val","css","width","height","hide","show","focus","select","newValue","html","$apply","updateFunctionArg","$index","event","which","registerLabelClick","toggleTools","registerToolsClick","$target","target","hasClass","removeFunction","moveFunction","FLAG","toolBar","closest","removeClass","addClass","relink","children","remove"],"mappings":"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","file":"func_editor.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport angular from 'angular';\n\nconst KEY_ESC = 27;\nconst KEY_ENTER = 13;\n\nangular\n  .module('grafana.directives')\n  .directive('dalmatinerFuncEditor', function($compile, templateSrv) {\n\n    var tmplLabel = '<a ng-click=\"\" title=\"Toggle function options\">{{func.name}}</a>';\n\n    var tmplArg = '<input type=\"text\" style=\"display: none; height: 1em;\" ' +\n      'class=\"input-mini tight-form-func-param\"></input>';\n\n    var tmplTools =\n      '<div class=\"tight-form-func-controls\">' +\n        '<span class=\"pointer fa fa-arrow-left\" ' +\n          'title=\"Swap this function with previous function\"></span>' +\n        '<span class=\"pointer fa fa-remove\" title=\"Remove this function\" ' +\n          'style=\"margin-right: 10px; font-size: 15px;\"></span>' +\n        '<span class=\"pointer fa fa-arrow-right\" ' +\n          'title=\"Swap this function with next function\"></span>' +\n      '</div>';\n\n    return {\n      restrict: 'A',\n      link: function postLink($scope, el) {\n\n        var $tmplLabel = $(tmplLabel);\n        var $tmplTools = $(tmplTools);\n\n        var ctrl = $scope.ctrl;\n        var func = $scope.func;\n\n        function addElementsAndCompile() {\n\n          $tmplTools.appendTo(el);\n          $tmplLabel.appendTo(el);\n\n          $('<span>(</span>').appendTo(el);\n\n          _.each(func.args, (arg, argIndex) => {\n\n            var argValue = templateSrv.highlightVariablesAsHtml(arg);\n            var $argField = $(tmplArg);\n\n            var $argLabel = $(\n              '<a ng-click=\"\" class=\"graphite-func-param-link\" ' +\n              `title=\"Edit function argument\">${argValue}</a>`\n            );\n\n            if (argIndex > 0) {\n              $('<span>, </span>').appendTo(el);\n            }\n\n            $argLabel.appendTo(el);\n            $argField.appendTo(el);\n\n            $argField.blur(_.partial(onArgEditDone, $argLabel, $argField, argIndex));\n            $argField.keyup(_.partial(onArgKeyPress, $argLabel, $argField, argIndex));\n            $argLabel.click(_.partial(onArgLabelClick, $argLabel, $argField, argIndex));\n          });\n\n          $('<span>)</span>').appendTo(el);\n\n          $compile(el.contents())($scope);\n        }\n\n        function onArgLabelClick($label, $field, argIndex) {\n          $field.val(func.args[argIndex]);\n          $field.css('width', ($label.width() + 2 * $label.height()) + 'px');\n          $label.hide();\n          $field.show();\n          $field.focus();\n          $field.select();\n        }\n\n        function onArgEditDone($label, $field, argIndex) {\n\n          var newValue = $field.val();\n\n          if (newValue && newValue !== func.args[argIndex]) {\n            $label.html(templateSrv.highlightVariablesAsHtml(newValue));\n            $scope.$apply(() => ctrl.updateFunctionArg($scope.$index, argIndex, newValue));\n          }\n\n          $field.hide();\n          $label.show();\n        }\n\n        function onArgKeyPress($label, $field, argIndex, event) {\n          switch (event.which) {\n            case KEY_ESC:\n              $field.val(func.args[argIndex]);\n              $field.hide();\n              $label.show();\n              break;\n            case KEY_ENTER:\n              onArgEditDone($label, $field, argIndex);\n              break;\n          }\n        }\n\n        function registerLabelClick() {\n          $tmplLabel.click(toggleTools);\n        }\n\n        function registerToolsClick() {\n          $tmplTools.click((event) => {\n            var $target = $(event.target);\n            switch (true) {\n              case $target.hasClass('fa-remove'):\n                $scope.$apply(() => ctrl.removeFunction($scope.$index));\n                break;\n              case $target.hasClass('fa-arrow-left'):\n                $scope.$apply(() => ctrl.moveFunction($scope.$index, $scope.$index - 1));\n                break;\n              case $target.hasClass('fa-arrow-right'):\n                $scope.$apply(() => ctrl.moveFunction($scope.$index, $scope.$index + 1));\n                break;\n            }\n          });\n        }\n\n        function toggleTools() {\n\n          const FLAG = 'is-open';\n          var toolBar = el.closest('.tight-form');\n\n          if (el.hasClass(FLAG)) {\n            el.removeClass(FLAG);\n            $tmplTools.hide();\n          } else {\n            el.addClass(FLAG);\n            $tmplTools.show();\n          }\n        }\n\n        function relink() {\n          el.children().remove();\n          addElementsAndCompile();\n          registerLabelClick();\n          registerToolsClick();\n        }\n\n        relink();\n      }\n    };\n  });\n"]}